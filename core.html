<!DOCTYPE html>

<head>
  <meta charset="utf-8"/>
  <title>core</title>
</head>

<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDIEaoy8b10jgq40JABqvYYayq_SlYS3AA",
    authDomain: "throwback-io-9ea21.firebaseapp.com",
    databaseURL: "https://throwback-io-9ea21.firebaseio.com",
    projectId: "throwback-io-9ea21",
    storageBucket: "throwback-io-9ea21.appspot.com",
    messagingSenderId: "424917555065"
  };
  firebase.initializeApp(config);
</script>

<script type="text/javascript">
var sessionID = 10;
var user = -1;
var othData = [];
initApp();

var myData = new Object();
var mainloop = function(){
    user = firebase.auth().currentUser;

    //update own state here
    if (user){
      myData.uid = user.uid;
      myData.x = document.getElementById("mytextx").value;
      myData.y = document.getElementById("mytexty").value;
      document.getElementById("data").innerHTML = user.uid + "</br>" + myData.x + "," + myData.y;
    
      //publish self state to server
      firebase.database().ref("game/" + sessionID + "/" + user.uid).set(myData);

      //get other's data from server
      firebase.database().ref('game/' + sessionID + "/").once('value').then(function(snapshot) {
        snapshot.forEach(function(childSnapshot){
          var item = childSnapshot.val();
          if (item.uid != user.uid)
            //update other object's state here
            document.getElementById("otherData").innerHTML = JSON.stringify(item);  
        });
  
      });
    }
}
setInterval(mainloop, 1000 / 60);


// Listening for auth state changes.
function initApp() {
  // [START authstatelistener]
  firebase.auth().onAuthStateChanged(function(user) {
    if (!user) {
        // User is not signed in.
        document.getElementById("data").innerHTML = "";
        window.location.href = "login.html";
      }else{
        refUser = firebase.auth().currentUser;
        document.getElementById("data").innerHTML = user.uid;
      }
    });
  // [END authstatelistener]
}
</script>

<body>
  <div id="testbox">
  <p id="data">xc</p>
  <p id="otherData">none</p>
hey
  </div>
<input id="mytextx" value="50"/>
<input id="mytexty" value="50"/>
<input id="data1"/>
</body>